<?php
//
// Description
// -----------
//
// Arguments
// ---------
// ciniki:
// settings:		The web settings structure.
// business_id:		The ID of the business to get events for.
//
// Returns
// -------
//
function ciniki_surveys_web_inviteDetails($ciniki, $settings, $business_id, $permalink) {

	//
	// Find the invite, and the survey from the permalink
	//
	$strsql = "SELECT ciniki_survey_invites.id, "
		. "FROM ciniki_survey_invites "
		. "LEFT JOIN ciniki_surveys ON (ciniki_survey_invites.survey_id = ciniki_surveys.id "
			. "AND ciniki_surveys.business_id = '" . ciniki_core_dbQuote($ciniki, $business_id) . "') "
		. "LEFT JOIN ciniki_survey_questions ON (ciniki_survey_invites.survey_id = ciniki_survey_questions.survey_id "
			. "AND ciniki_survey_questions.business_id = '" . ciniki_core_dbQuote($ciniki, $business_id) . "') "
		. "WHERE ciniki_survey_invites.business_id = '" . ciniki_core_dbQuote($ciniki, $business_id) . "' "
		. "AND ciniki_survey_invites.permalink = '" . ciniki_core_dbQuote($ciniki, $permalink) . "' "
		. "AND ciniki_survey_invites.status < 30 "		// Not yet responded
		. "";

	//
	// Update the date_seen on the invite
	//

	// FIXME: Only return survey if invite still unanswered

	return array('stat'=>'ok', 'survey'=>$survey);	
}
?>
